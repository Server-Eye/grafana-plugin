/*! For license information please see module.js.LICENSE.txt */
define(["react","@grafana/data","@grafana/ui","@grafana/runtime"],(function(e,t,n,r){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=4)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=r},function(e,t,n){"use strict";n.r(t);var r=n(1),a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function o(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var i=function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function u(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function u(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,u)}s((r=r.apply(e,t||[])).next())}))}function s(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}}var c=n(3),l=function(e){function t(t){var n=e.call(this,t)||this;switch(t.jsonData.backendServerVersion){case"BETA":n.proxyPath="grafana-plugin-beta";break;default:n.proxyPath="grafana-plugin"}return n.backendServerURL=t.url||"https://api-ms.server-eye.de/3/grafana-plugin",n}return t.$inject=["instanceSettings"],o(t,e),t.prototype.query=function(e){return u(this,void 0,Promise,(function(){var t,n,a,o=this;return s(this,(function(i){switch(i.label){case 0:return t=e.range,n=(null==t?void 0:t.from.valueOf())||0,a=(null==t?void 0:t.to.valueOf())||0,[4,Promise.all(e.targets.map((function(e){var t=e;return t.hide?new r.MutableDataFrame:o.doQuery(e.agentid,e.selectedAgentTarget.value||"",n,a).then((function(n){if(!n||!n.length)return new r.MutableDataFrame;var a=[],o=[];n.forEach((function(e){e&&(a.push(e.msDate),o.push(e.value))}));var i=[{type:"time",values:a},{name:t.selectedAgentTarget.value,type:"number",values:o}];return new r.MutableDataFrame({name:e.selectedAgentTarget.value,refId:t.refId,fields:i})}))})))];case 1:return[2,{data:i.sent()}]}}))}))},t.prototype.doQuery=function(e,t,n,r){return u(this,void 0,Promise,(function(){var a;return s(this,(function(o){return a=this.backendServerURL+"/"+this.proxyPath+"/"+e+"/"+t+"/"+n+"/"+r,[2,Object(c.getBackendSrv)().datasourceRequest({url:a}).then((function(e){return e.data})).catch((function(e){return e}))]}))}))},t.prototype.retrieveTargetsForAgent=function(e){return u(this,void 0,Promise,(function(){var t;return s(this,(function(n){return t=this.backendServerURL+"/"+this.proxyPath+"/"+e+"/targets",[2,Object(c.getBackendSrv)().datasourceRequest({url:t,method:"GET"}).then((function(e){return e.data})).catch((function(e){return e}))]}))}))},t.prototype.testDatasource=function(){return u(this,void 0,void 0,(function(){return s(this,(function(e){return[2,{status:"success",message:"Success"}]}))}))},t}(r.DataSourceApi),f=n(0),p=n.n(f),h=n(2),g=h.LegacyForms.SecretFormField,d=h.LegacyForms.Select,v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onAPIKeyChange=function(e){var n=t.props,r=n.onOptionsChange,a=n.options;r(i(i({},a),{secureJsonData:{apiKey:e.target.value}}))},t.onResetAPIKey=function(){var e=t.props,n=e.onOptionsChange,r=e.options;n(i(i({},r),{secureJsonFields:i(i({},r.secureJsonFields),{apiKey:!1}),secureJsonData:i(i({},r.secureJsonData),{apiKey:""})}))},t.onBackendServerVersionChange=function(e){var n=t.props,r=n.onOptionsChange,a=n.options;r(i(i({},a),{jsonData:i(i({},a.jsonData),{backendServerVersion:e.value})}))},t}return o(t,e),t.prototype.render=function(){var e=this.props.options,t=e.secureJsonFields,n=e.secureJsonData||{},r=[{label:"Beta",value:"BETA",description:"Use the beta-version of the server-eye API. New changes are published here first. UNSTABLE"},{label:"Production",value:"PRODUCTION",description:"Use the production-version of the server-eye API. STABLE"}],a=r.find((function(t){return t.value===e.jsonData.backendServerVersion}));return p.a.createElement("div",{className:"gf-form-group"},p.a.createElement("div",{className:"gf-form-inline"},p.a.createElement("div",{className:"gf-form"},p.a.createElement("label",{className:"gf-form-label width-6"},"Api Version"),p.a.createElement(d,{className:"gf-form-select width-8",value:a,placeholder:"Select API Version",options:r,onChange:this.onBackendServerVersionChange}))),p.a.createElement("div",{className:"gf-form-inline"},p.a.createElement("div",{className:"gf-form"},p.a.createElement(g,{isConfigured:t&&t.apiKey,value:n.apiKey,label:"API Key",placeholder:"Your API key from Server-Eye",labelWidth:6,inputWidth:24,onReset:this.onResetAPIKey,onChange:this.onAPIKeyChange}))))},t}(f.PureComponent),y=h.LegacyForms.FormField,m=/[a-z0-9]{8}\-[a-z0-9]{4}\-[a-z0-9]{4}\-[a-z0-9]{4}\-[a-z0-9]{12}/g,b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onAgentTargetChange=function(e){var n=t.props,r=n.onChange,a=n.query;r(i(i({},a),{selectedAgentTarget:e}))},t.onAgentIDChange=function(e){var n=t.props,r=n.onChange,a=n.query;r(i(i({},a),{agentid:e.target.value})),e.target.value.match(m)&&t.refreshPossibleAgentTargets(e.target.value)},t}return o(t,e),t.prototype.refreshPossibleAgentTargets=function(e){return u(this,void 0,void 0,(function(){var t,n=this;return s(this,(function(r){return t=function(){return e||n.props.query.agentid},this.props.datasource.retrieveTargetsForAgent(t()).then((function(e){var t=e.map((function(e){return{label:e.saveName,value:e.saveName,description:e.name}})),r=n.props,a=r.onChange,o=r.query;a(i(i({},o),{possibleAgentTargets:t}))})),[2]}))}))},t.prototype.render=function(){var e=this.props.query,t=e.agentid,n=e.possibleAgentTargets,r=e.selectedAgentTarget;return p.a.createElement("div",{className:"gf-form"},p.a.createElement(y,{width:100,value:t,onChange:this.onAgentIDChange,label:"AgentID",type:"string"}),p.a.createElement(h.Select,{value:r,placeholder:"Select Agent Target",options:n,onChange:this.onAgentTargetChange}))},t}(f.PureComponent);n.d(t,"plugin",(function(){return A}));var A=new r.DataSourcePlugin(l).setConfigEditor(v).setQueryEditor(b)}])}));
//# sourceMappingURL=module.js.map