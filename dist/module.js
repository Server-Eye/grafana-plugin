define(["react","@grafana/data","@grafana/ui"],(function(e,t,n){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=3)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t,n){"use strict";n.r(t);var r=n(1),o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function a(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var u=function(){return(u=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function i(e,t,n,r){return new(n||(n=Promise))((function(o,a){function u(e){try{s(r.next(e))}catch(e){a(e)}}function i(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(u,i)}s((r=r.apply(e,t||[])).next())}))}function s(e,t){var n,r,o,a,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(a){return function(i){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return u.label++,{value:a[1],done:!1};case 5:u.label++,r=a[1],a=[0];continue;case 7:a=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){u=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){u.label=a[1];break}if(6===a[0]&&u.label<o[1]){u.label=o[1],o=a;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(a);break}o[2]&&u.ops.pop(),u.trys.pop();continue}a=t.call(e,u)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,i])}}}var c=function(e){function t(t,n){var r=e.call(this,t)||this;return r.backendSrv=n,r.backendServerPort=t.jsonData.backendServerPort||80,r.backendServerURL=t.url||"https://grafana-backend.server-eye.de",r.backendSrv=n,r}return t.$inject=["instanceSettings","backendSrv"],a(t,e),t.prototype.query=function(e){var t,n;return i(this,void 0,void 0,(function(){var o,a,u,i=this;return s(this,(function(s){switch(s.label){case 0:return o=e.range,a=(null===(t=o)||void 0===t?void 0:t.from.valueOf())||0,u=(null===(n=o)||void 0===n?void 0:n.to.valueOf())||0,[4,Promise.all(e.targets.map((function(e){var t=e;return t.hide?new r.MutableDataFrame:i.doQuery(e.agentid,e.selectedAgentTarget.value||"",a,u).then((function(e){if(!e.values)return new r.MutableDataFrame;var n=[],o=[];e.values.forEach((function(e){n.push(e.msDate),o.push(e.value)}));var a=[{type:"time",values:n},{name:t.selectedAgentTarget.value,type:"number",values:o}];return new r.MutableDataFrame({refId:t.refId,fields:a})}))})))];case 1:return[2,{data:s.sent()}]}}))}))},t.prototype.doQuery=function(e,t,n,r){return i(this,void 0,void 0,(function(){return s(this,(function(o){return[2,this.backendSrv.datasourceRequest({url:this.backendServerURL+"/values/1/agent/"+e+"/"+n+"/"+r+"/"+t}).then((function(e){return e.data})).catch((function(e){return e}))]}))}))},t.prototype.retrieveTargetsForAgent=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){return[2,this.backendSrv.datasourceRequest({url:this.backendServerURL+"/targets/1/agent/"+e+"/targets",method:"GET"}).then((function(e){return e.data})).catch((function(e){return e}))]}))}))},t.prototype.testDatasource=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){return[2,{status:"success",message:"Success"}]}))}))},t}(r.DataSourceApi),l=n(0),f=n.n(l),p=n(2),d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onAPIKeyChange=function(e){var n=t.props,r=n.onOptionsChange,o=n.options;r(u(u({},o),{secureJsonData:{apiKey:e.target.value}}))},t.onResetAPIKey=function(){var e=t.props,n=e.onOptionsChange,r=e.options;n(u(u({},r),{secureJsonFields:u(u({},r.secureJsonFields),{apiKey:!1}),secureJsonData:u(u({},r.secureJsonData),{apiKey:""})}))},t}return a(t,e),t.prototype.render=function(){var e=this.props.options,t=e.secureJsonFields,n=e.secureJsonData||{};return f.a.createElement("div",{className:"gf-form-group"},f.a.createElement("div",{className:"gf-form-inline"},f.a.createElement("div",{className:"gf-form"},f.a.createElement(p.SecretFormField,{isConfigured:t&&t.apiKey,value:n.apiKey,label:"API Key",placeholder:"Your API key from Server-Eye",labelWidth:6,inputWidth:24,onReset:this.onResetAPIKey,onChange:this.onAPIKeyChange}))))},t}(l.PureComponent),v=/[a-z0-9]{8}\-[a-z0-9]{4}\-[a-z0-9]{4}\-[a-z0-9]{4}\-[a-z0-9]{12}/g,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onAgentTargetChange=function(e){var n=t.props,r=n.onChange,o=n.query;r(u(u({},o),{selectedAgentTarget:e}))},t.onAgentIDChange=function(e){var n=t.props,r=n.onChange,o=n.query;r(u(u({},o),{agentid:e.target.value})),e.target.value.match(v)&&t.refreshPossibleAgentTargets(e.target.value)},t}return a(t,e),t.prototype.refreshPossibleAgentTargets=function(e){return i(this,void 0,void 0,(function(){var t,n=this;return s(this,(function(r){return t=function(){return e||n.props.query.agentid},this.props.datasource.retrieveTargetsForAgent(t()).then((function(e){var t=e.map((function(e){return{label:e.saveName,value:e.saveName,description:e.name}})),r=n.props,o=r.onChange,a=r.query;o(u(u({},a),{possibleAgentTargets:t}))})),[2]}))}))},t.prototype.render=function(){var e=this.props.query,t=e.agentid,n=e.possibleAgentTargets,r=e.selectedAgentTarget;return f.a.createElement("div",{className:"gf-form"},f.a.createElement(p.FormField,{width:100,value:t,onChange:this.onAgentIDChange,label:"AgentID",type:"string"}),f.a.createElement(p.Select,{value:r,placeholder:"Select Agent Target",options:n,onChange:this.onAgentTargetChange}))},t}(l.PureComponent);n.d(t,"plugin",(function(){return g}));var g=new r.DataSourcePlugin(c).setConfigEditor(d).setQueryEditor(h)}])}));